### 长连接

### 简介

长连接是指通信双方建立 TCP 连接后进行通信，通信完毕后，不主动断开连接，而是保持连接。

#### 优点

- 通信速度快

  每次请求不需要重新建立连接，只需要简单的数据发送；免去了 DNS 解析时间

- 降低网络资源的浪费

#### 应用场景

- 双方通信频繁
- 具备实时需求

### 长连接保活

长连接需要持续保持双方连接才可使得双方持续通信

但是，长连接存在断开的情况：

- 长连接所在进程被杀死

- NAT 超时

  NAT(Network Address Translation)，将手机内网 IP 转换到外网 IP 的过程。为了减少网关的链路负荷，节省通道资源。运营商规定，若 1 个手机网络链路在一段时间内未发生通信，则会断开该网络链接。

- 网络状态发生变化

- 其他不可抗拒因素

  网络状态差，DHCP 租约到期等。

因此，针对以上原因，长连接保活的方案如下：

- 进程保活

  - 提高进程优先级，降低进程被杀死的概率
  - 进程被杀死后，进行拉活重建

- 心跳保活机制

  每隔一段时间向服务端发送自定义信息，以确保连接存活并且有效的通信机制

  **是否可以用 TCP 协议自带的 KeepAlive 机制替代心跳机制**

  不可以，因为 KeepAlive 机制的作用是检测连接的有无，但无法检测连接是否有效。连接有效=双方具备发送&接受消息的能力。

- 断线重连机制

